# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Информация о товаре

```
interface IProduct {
  id: string;
  title: string;
  description: string;
  image: string;
  category: string;
  price: number | null;
}
```

Интерфейс оформления заказа

```
interface IOrder {
  payment: TPayment;
  email: string;
  phone: string;
  address: string;
  total: number | null;
  items: TProductSelected[];
}
```

Тип данных обозначения категории товаров

```
type TCategory = 'софт-скил' | 'другое' | 'дополнительное' | 'кнопка' | 'хард-скил'
```

Тип данных для вывода статуса работы модели с корзиной

```
type TBasketMessage = 'Товар успешно добавлен в корзину' | 'Товар успешно удален из корзины' | 'Ошибка! Товар уже находится в корзине' | 'Ошибка! Товар отстутсвует в корзине'
```

Тип данных для выбора способа оплаты товаров

```
type TPayment = 'cash' | 'card';
```

Тип данных для сбора информации из форм оформления заказа

```
type TOrderInfo = Pick<IOrder, 'address' | 'email' | 'phone' | 'payment'>;
```
Тип данных для валидации полей форм оформления заказа

```
type FormErrors = Partial<Record<keyof TOrderInfo, string>>;
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP: 
- слой представления, отвечает за отображение данных на странице, 
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие.

#### Класс Model
Базовая модель класса, конструктор класса принимает инстант брокера событий\
Служит прототипом для всех моделей, включает методы общие для всех моделей.

#### Класс Component
Абстрактный базовый класс, конструктор класса принимает элемент разметки как контейнер, в методах класса содержатся необходимые инструменты для работы с DOM, а также метод render, который собирает возвращает корневой DOM-элемент/
Служит прототипом для все классов отображения.

### Слой данных

#### Класс ProductsData
Класс отвечает за хранение и логику работы с данными карточек товара,полученных с сервера, наследуется от базового класса модели данных\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- productCards: IProduct[] | null - массив объектов карточек
- preview: string | null - id карточки, выбранной для просмотра в модальной окне или добавленной в корзину.


Так же класс предоставляет набор методов для взаимодействия с этими данными.
- сеттер productList(info: IProduct[]): void выполняет функцию сохранения в поле класса информации о всех карточках товара, принимает данные в виде массива с интерфейсом IProduct[], инициализирует событие - изменение списка элементов.
- геттер productList() необходим для получения данных из поля класса с сохраненными карточками товаров.
- сеттер productId(id: string) выполняет функцию сохранения в поле класса preview id одной карточки, принимает строку и инициализирует событие - изменение предварительного просмотра.
- геттер productId() необходим для получения значения из поля класса preview.
- getSelectedCard(): IProduct метод для получения данных выбранной карточки из массива всех карточек товара, выполняет сравнение id карточек в массиве, хранящемся в поле класса productCards, с id, хранящимся в поле класса preview, возвращает данные карточки в указанном формате.

#### Класс OrderData
Класс отвечает за хранение данных покупателя и сбор информации о приобретаемом товаре, наследуется от базового класса модели данных\
В полях класса хранятся:
- объект protected order: TOrderInfo = {/
 payment: TPayment - способ оплаты товара, по умолчанию оплата 'card'/
 email: string - электронная почта покупателя/
 phone: string - номер телефона покупателя/
 address: string - адресс доставки}/
 - formErrors: FormErrors = {} хранит ошибки валидации

Так же класс предоставляет набор методов для взаимодействия с этими данными.\
- setOrderField(field: keyof TOrderInfo, value: string) - сохранение данных из полей форм оформления заказа, если данные валидные инициализирует событие - заказ готов.
- validateOrder() и validateUser() - валидируют данные введенные пользователем и сохраняют значение ошибки.
- resetOrderInfo() - сбрасывает все сохраненные данные.
- сеттер для сохранения информации о способе оплаты.

#### Класс BasketData
Класс отвечает за хранение данных о товарах, добавленных в корзину.
Наследуется от базового класса модели данных\
В полях класса хранятся следующие данные:
- basketCards: TProduct[] - массив выбранных карточек
- basketMessage: TBasketMessage - сообщения для вывода статуса добавления или удаления товара
- added: boolean - поле для сохранения результата проверки товара в корзине

Так же класс предоставляет набор методов для взаимодействия с этими данными.\
- геттер basketCardsInfo() - возвращает массив карточек из поля класса basketCards.
- addProduct(product: IProduct): void добавляет информацию о выбранной карточки в массив корзины, вызывает событие изменения массива.
- deleteProduct(product: IProduct): void - удаляет информацию карточки из массива корзины, вызывает событие изменения массива.
- checkProductId(product: IProduct): boolean - выполняет проверку, есть ли id выбранного товара в массиве корзины, сохраняет в поле класса true, если находит совпадение.
- getTotalPrice(): number - получение общей суммы заказа
- getBasketProductsId(): string[] - возвращает массив id карточек в корзине.
- resetProductBasket(): void; - удаление информации о всех товарах из списка корзины, вызывает событие изменения массива.

### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Page
Реализует отображение на странице всех карточек товара и количества товаров в корзине пользователя. Наследуется от базового класса Component.

Поля класса:
- basketCount: HTMLElement - элемент страницы для отображения количества товаров в корзине
- galeryItems: HTMLElement[] - массив элементов страницы для отображения карточек товара
- locked: boolean - значение, отвечающее за блокрировку прокрутки страницы

Методы:
- сеттер counter(value: number) - пристваивает значение для отображения количества товаров в корзине
- сеттер galeryItems(items: HTMLElement[]) - выводит элементы карточек на страницу
- set locked(value: boolean) - блокирует прокрутку страницы

#### Класс Modal
Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели для закрытия модального окна на клик в оверлей и кнопку-крестик для закрытия попапа.  
Конструктор принимает HTMLElement контейнера, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса
- _content: HTMLElement - элемент контента выводимого в модальном окне
- _closeButton: HTMLElement - элемент разметки кнопки для закрытия модельного окна

Методы:
- set content(content: HTMLElement) - добавление собранного элемента разметки с контентом
- openModal(): void - открытие модального окна
- closeModal(): void - закрытие модального окна
- render(data: IModal): HTMLElement - расширение родительского класса, собирает готовый элемент модального окна и открывает его

#### Класс Form
Предназначен для реализации элементов формы содержащей поля ввода./
Наследуется от базового класса Сomponent/
При сабмите инициирует событие передавая в него объект с данными из полей ввода формы. При изменении данных в полях ввода инициирует событие изменения данных. Предоставляет методы для отображения ошибок и управления активностью кнопки сохранения.\
Поля класса:
- _submit: HTMLButtonElement - Кнопка подтверждения
- errors: HTMLElement - элемент для вывода ошибок валидации

Методы:
- set valid(value: boolean) - изменяет активность кнопки продолжения оформления заказа или оплаты
- protected onInputChange(field: keyof T, value: string) - инициирует событие изменения полей форм ввода, возвращает объект с данными из полей формы, где ключ - name инпута, значение - данные введенные пользователем
- set errors(value: string) - принимает и отображает значение для отображения текста ошибок под полями ввода
- render(state: Partial<T> & IFormState) - собирает и возвращает контейнер с формой

Классы UserInfo и OrderInfo расширают класс Form, определяя конкретные поля ввода данных.

#### Класс Basket
Предназначен для реализации отображения корзины товаров. Получает данные товаров в корзине, которые нужно отобразить.\
Конструктор принимает HTMLElement контейнера, по которому в разметке страницы будет идентифицирован темплейт и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса:
- _list: HTMLElement - элемент разметки со списком
- _total: HTMLElement - элемент разметки для вывода общей суммы заказа
- _button: HTMLButtonElement - элемент разметки кнопки оформления заказа

Методы:
- сеттер items(items: HTMLElement[]) - метод для добавления элементов разметки карточки.
- сеттер total(total: number) - метод для вывода общей суммы товаров в корзине.

#### Класс SuccessModal
Предназначен для реализации отображения успешной оплаты заказа. Получает данные суммы списания, которые нужно отобразить.\
Класс наследуется от базового Component\
Конструктор принимает HTMLElement контейнера, по которому в разметке страницы будет идентифицирован темплейт и интерфейс ISuccessActions для возможности инициации событий.

Поля класса:
- _total: HTMLElement - элемент разметки для вывода общей оплачнной суммы
- _сlose: HTMLButtonElement - элемент разметки кнопки перейти к покупкам

Методы:
- сеттер total(total: number) - метод для вывода общей суммы оплаты.

#### Класс Card
Отвечает за отображение карточки товара, задавая в карточке данные названия, изображения, категории, цены, а также возможность реагировать на действия пользователя добавить и удалить товар. Класс наследуется от базового Component и используется для отображения карточек на странице сайта. В конструктор класса передается DOM элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события.\
Поля класса содержат элементы разметки элементов карточки. Конструктор, кроме темплейта принимает интерфейс ICardActions для инициации событий.\

## Слой коммуникации

#### Класс LarekAPI
Класс для работы с сервером приложения weblarek, наследуется от базового класса api, расширяя его.

Включает методы: 
- getProductList(): Promise<ApiListResponse<IProduct>> - метод для получения массива объектов карточек с сервера.
- orderProduct(order: IOrder): Promise<IOrder> - метод для отправки данных о покупке на сервер.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*
- `user:changed` - изменение данных пользователя
- `items:changed` - изменение массива карточек
- `preview:change` - изменение открываемой в модальном окне карточки
- `basketProduct:change` - изменения в корзине продуктов
- `order:ready` - заполнение всех обязательных полей оформления заказа
- `formErrors:change` - изменения в ошибках валидации

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `basket:open` - открытие модального окна с корзиной
- `order:open` - открытие модального окна с формой сбора информации о способе оплаты, адресе доставки
- `order:submit` - открытие модального окна с формой сбора данных номер телефона, электронная почта
- `card:select` - выбор карточки
- `card:add` - добавление карточки в корзину
- `card:delete` - удаление карточки из корзины
- `order:submit` - сохранение данных о способе оплаты и адресе доставки
- `contacts:submit` - событие отправка товара на оплату
- `modal:close` - событие, сообщающее о закрытии любого модального окна
- `modal:open` - событие, сообщающее об открытии любого модального окна